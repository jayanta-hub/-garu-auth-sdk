{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["// src/index.ts\r\ninterface User {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role?: string;\r\n}\r\n\r\ninterface AuthConfig {\r\n  domain?: string;\r\n  secure?: boolean;\r\n  sameSite?: 'strict' | 'lax' | 'none';\r\n  crossOriginEnabled?: boolean;\r\n  tokenExpiry?: number; // in milliseconds\r\n}\r\n\r\nclass AuthManager {\r\n  private user: User | null = null;\r\n  private listeners: ((user: User | null) => void)[] = [];\r\n  private config!: AuthConfig;\r\n  private tokenExpiryTime: number | null = null;\r\n\r\n  constructor(config: AuthConfig = {}) {\r\n    if ((AuthManager as any).instance) {\r\n      return (AuthManager as any).instance;\r\n    }\r\n\r\n    this.config = {\r\n      domain: config.domain || window.location.hostname,\r\n      secure: config.secure ?? window.location.protocol === 'https:',\r\n      sameSite: config.sameSite || 'lax',\r\n      crossOriginEnabled: config.crossOriginEnabled ?? true,\r\n      tokenExpiry: config.tokenExpiry || 24 * 60 * 60 * 1000, // 24 hours default\r\n      ...config\r\n    };\r\n\r\n    this.restoreSession();\r\n    this.setupCrossOriginListener();\r\n    (AuthManager as any).instance = this;\r\n  }\r\n\r\n  login(user: User, token: string) {\r\n    this.user = user;\r\n    this.tokenExpiryTime = Date.now() + (this.config.tokenExpiry || 0);\r\n    \r\n    // Store in localStorage\r\n    localStorage.setItem('auth:token', token);\r\n    localStorage.setItem('auth:user', JSON.stringify(user));\r\n    localStorage.setItem('auth:expiry', this.tokenExpiryTime.toString());\r\n    \r\n    // Store in cookies for cross-application sharing\r\n    this.setCookie('auth_token', token, this.config.tokenExpiry || 0);\r\n    this.setCookie('auth_user', JSON.stringify(user), this.config.tokenExpiry || 0);\r\n    \r\n    this.notify();\r\n    this.broadcast('login', user);\r\n    \r\n    // Store in sessionStorage for current tab\r\n    sessionStorage.setItem('auth:token', token);\r\n    sessionStorage.setItem('auth:user', JSON.stringify(user));\r\n  }\r\n\r\n  logout() {\r\n    this.user = null;\r\n    this.tokenExpiryTime = null;\r\n    \r\n    // Clear all storage\r\n    localStorage.removeItem('auth:token');\r\n    localStorage.removeItem('auth:user');\r\n    localStorage.removeItem('auth:expiry');\r\n    sessionStorage.removeItem('auth:token');\r\n    sessionStorage.removeItem('auth:user');\r\n    \r\n    // Clear cookies\r\n    this.deleteCookie('auth_token');\r\n    this.deleteCookie('auth_user');\r\n    \r\n    this.notify();\r\n    this.broadcast('logout');\r\n  }\r\n\r\n  isLoggedIn(): boolean {\r\n    if (!this.user) return false;\r\n    \r\n    // Check if token has expired\r\n    if (this.tokenExpiryTime && Date.now() > this.tokenExpiryTime) {\r\n      this.logout();\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n\r\n  getUser(): User | null {\r\n    return this.user;\r\n  }\r\n\r\n  getToken(): string | null {\r\n    return localStorage.getItem('auth:token') || sessionStorage.getItem('auth:token');\r\n  }\r\n\r\n  // Method to share auth with another application via URL\r\n  generateAuthUrl(targetUrl: string): string {\r\n    if (!this.isLoggedIn()) {\r\n      throw new Error('User must be logged in to generate auth URL');\r\n    }\r\n    \r\n    const token = this.getToken();\r\n    const user = this.getUser();\r\n    \r\n    if (!token || !user) {\r\n      throw new Error('Invalid auth state');\r\n    }\r\n    \r\n    const url = new URL(targetUrl);\r\n    url.searchParams.set('auth_token', token);\r\n    url.searchParams.set('auth_user', JSON.stringify(user));\r\n    url.searchParams.set('auth_timestamp', Date.now().toString());\r\n    \r\n    return url.toString();\r\n  }\r\n\r\n  // Method to process auth from URL (for receiving applications)\r\n  processAuthFromUrl(): boolean {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const token = urlParams.get('auth_token');\r\n    const userStr = urlParams.get('auth_user');\r\n    const timestamp = urlParams.get('auth_timestamp');\r\n    \r\n    if (token && userStr && timestamp) {\r\n      try {\r\n        const user = JSON.parse(userStr);\r\n        const authTime = parseInt(timestamp);\r\n        \r\n        // Check if auth is not too old (5 minutes)\r\n        if (Date.now() - authTime < 5 * 60 * 1000) {\r\n          this.login(user, token);\r\n          \r\n          // Clean up URL parameters\r\n          const url = new URL(window.location.href);\r\n          url.searchParams.delete('auth_token');\r\n          url.searchParams.delete('auth_user');\r\n          url.searchParams.delete('auth_timestamp');\r\n          window.history.replaceState({}, '', url.toString());\r\n          \r\n          return true;\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to process auth from URL:', e);\r\n      }\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  // Method to share auth with another application via postMessage\r\n  shareAuthWithApp(targetOrigin: string, targetWindow: Window) {\r\n    if (!this.isLoggedIn()) {\r\n      throw new Error('User must be logged in to share auth');\r\n    }\r\n    \r\n    const token = this.getToken();\r\n    const user = this.getUser();\r\n    \r\n    if (!token || !user) {\r\n      throw new Error('Invalid auth state');\r\n    }\r\n    \r\n    targetWindow.postMessage({\r\n      type: 'AUTH_SHARE',\r\n      auth: { token, user, timestamp: Date.now() }\r\n    }, targetOrigin);\r\n  }\r\n\r\n  subscribe(listener: (user: User | null) => void): () => void {\r\n    this.listeners.push(listener);\r\n    return () => {\r\n      this.listeners = this.listeners.filter(l => l !== listener);\r\n    };\r\n  }\r\n\r\n  private notify() {\r\n    this.listeners.forEach(listener => listener(this.user));\r\n  }\r\n\r\n  private broadcast(type: 'login', user: User): void;\r\n  private broadcast(type: 'logout'): void;\r\n  private broadcast(type: string, user?: User) {\r\n    // Cross-tab sync\r\n    window.postMessage({ type: `AUTH_${type.toUpperCase()}`, user }, '*');\r\n    try {\r\n      const channel = new BroadcastChannel('auth:channel');\r\n      channel.postMessage({ type, user });\r\n      channel.close();\r\n    } catch (e) {\r\n      console.warn('BroadcastChannel not supported');\r\n    }\r\n  }\r\n\r\n  private restoreSession() {\r\n    // Try to restore from cookies first (for cross-application sharing)\r\n    const cookieToken = this.getCookie('auth_token');\r\n    const cookieUser = this.getCookie('auth_user');\r\n    \r\n    // Fallback to localStorage\r\n    const localToken = localStorage.getItem('auth:token');\r\n    const localUser = localStorage.getItem('auth:user');\r\n    \r\n    // Use whichever is available\r\n    const token = cookieToken || localToken;\r\n    const userStr = cookieUser || localUser;\r\n    \r\n    if (token && userStr) {\r\n      try {\r\n        this.user = JSON.parse(userStr);\r\n        const expiryStr = localStorage.getItem('auth:expiry');\r\n        if (expiryStr) {\r\n          this.tokenExpiryTime = parseInt(expiryStr);\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to restore user session:', e);\r\n        this.logout();\r\n      }\r\n    }\r\n  }\r\n\r\n  private setupCrossOriginListener() {\r\n    if (!this.config.crossOriginEnabled) return;\r\n    \r\n    // Listen for auth sharing from other applications\r\n    window.addEventListener('message', (event) => {\r\n      if (event.data.type === 'AUTH_SHARE') {\r\n        const { token, user, timestamp } = event.data.auth;\r\n        \r\n        // Check if auth is not too old (5 minutes)\r\n        if (Date.now() - timestamp < 5 * 60 * 1000) {\r\n          this.login(user, token);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private setCookie(name: string, value: string, maxAge: number) {\r\n    const cookie = `${name}=${encodeURIComponent(value)}; max-age=${maxAge}; path=/; domain=${this.config.domain}; ${this.config.secure ? 'secure;' : ''} samesite=${this.config.sameSite}`;\r\n    document.cookie = cookie;\r\n  }\r\n\r\n  private getCookie(name: string): string | null {\r\n    const value = `; ${document.cookie}`;\r\n    const parts = value.split(`; ${name}=`);\r\n    if (parts.length === 2) {\r\n      return decodeURIComponent(parts.pop()?.split(';').shift() || '');\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private deleteCookie(name: string) {\r\n    this.setCookie(name, '', -1);\r\n  }\r\n\r\n  static listenForExternalChanges() {\r\n    // Listen to BroadcastChannel\r\n    try {\r\n      const channel = new BroadcastChannel('auth:channel');\r\n      channel.onmessage = (event) => {\r\n        const manager = new AuthManager();\r\n        if (event.data.type === 'login') {\r\n          manager.user = event.data.user;\r\n          manager.notify();\r\n        } else if (event.data.type === 'logout') {\r\n          manager.user = null;\r\n          manager.notify();\r\n        }\r\n      };\r\n    } catch (e) {\r\n      console.warn('BroadcastChannel not available');\r\n    }\r\n\r\n    // Listen to postMessage (fallback)\r\n    window.addEventListener('message', (event) => {\r\n      const manager = new AuthManager();\r\n      if (event.data.type === 'AUTH_LOGIN') {\r\n        manager.user = event.data.user;\r\n        manager.notify();\r\n      } else if (event.data.type === 'AUTH_LOGOUT') {\r\n        manager.user = null;\r\n        manager.notify();\r\n      }\r\n    });\r\n\r\n    // Listen to localStorage changes (cross-tab)\r\n    window.addEventListener('storage', (event) => {\r\n      if (event.key === 'auth:user' && !event.newValue && event.oldValue) {\r\n        const manager = new AuthManager();\r\n        manager.user = null;\r\n        manager.notify();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport const authManager = new AuthManager();\r\nexport type { User, AuthConfig };"],"names":[],"mappings":";;AAgBA,MAAM,WAAW,CAAA;AAMf,IAAA,WAAA,CAAY,SAAqB,EAAE,EAAA;QAL3B,IAAA,CAAA,IAAI,GAAgB,IAAI;QACxB,IAAA,CAAA,SAAS,GAAoC,EAAE;QAE/C,IAAA,CAAA,eAAe,GAAkB,IAAI;AAG3C,QAAA,IAAK,WAAmB,CAAC,QAAQ,EAAE;YACjC,OAAQ,WAAmB,CAAC,QAAQ;QACtC;QAEA,IAAI,CAAC,MAAM,GAAG;YACZ,MAAM,EAAE,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,QAAQ;YACjD,MAAM,EAAE,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,QAAQ,KAAK,QAAQ;AAC9D,YAAA,QAAQ,EAAE,MAAM,CAAC,QAAQ,IAAI,KAAK;AAClC,YAAA,kBAAkB,EAAE,MAAM,CAAC,kBAAkB,IAAI,IAAI;AACrD,YAAA,WAAW,EAAE,MAAM,CAAC,WAAW,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI;AACtD,YAAA,GAAG;SACJ;QAED,IAAI,CAAC,cAAc,EAAE;QACrB,IAAI,CAAC,wBAAwB,EAAE;AAC9B,QAAA,WAAmB,CAAC,QAAQ,GAAG,IAAI;IACtC;IAEA,KAAK,CAAC,IAAU,EAAE,KAAa,EAAA;AAC7B,QAAA,IAAI,CAAC,IAAI,GAAG,IAAI;AAChB,QAAA,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,MAAM,CAAC,WAAW,IAAI,CAAC,CAAC;;AAGlE,QAAA,YAAY,CAAC,OAAO,CAAC,YAAY,EAAE,KAAK,CAAC;AACzC,QAAA,YAAY,CAAC,OAAO,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;AACvD,QAAA,YAAY,CAAC,OAAO,CAAC,aAAa,EAAE,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,CAAC;;AAGpE,QAAA,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,IAAI,CAAC,CAAC;QACjE,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,IAAI,CAAC,CAAC;QAE/E,IAAI,CAAC,MAAM,EAAE;AACb,QAAA,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,CAAC;;AAG7B,QAAA,cAAc,CAAC,OAAO,CAAC,YAAY,EAAE,KAAK,CAAC;AAC3C,QAAA,cAAc,CAAC,OAAO,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;IAC3D;IAEA,MAAM,GAAA;AACJ,QAAA,IAAI,CAAC,IAAI,GAAG,IAAI;AAChB,QAAA,IAAI,CAAC,eAAe,GAAG,IAAI;;AAG3B,QAAA,YAAY,CAAC,UAAU,CAAC,YAAY,CAAC;AACrC,QAAA,YAAY,CAAC,UAAU,CAAC,WAAW,CAAC;AACpC,QAAA,YAAY,CAAC,UAAU,CAAC,aAAa,CAAC;AACtC,QAAA,cAAc,CAAC,UAAU,CAAC,YAAY,CAAC;AACvC,QAAA,cAAc,CAAC,UAAU,CAAC,WAAW,CAAC;;AAGtC,QAAA,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC;AAC/B,QAAA,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC;QAE9B,IAAI,CAAC,MAAM,EAAE;AACb,QAAA,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC;IAC1B;IAEA,UAAU,GAAA;QACR,IAAI,CAAC,IAAI,CAAC,IAAI;AAAE,YAAA,OAAO,KAAK;;AAG5B,QAAA,IAAI,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,eAAe,EAAE;YAC7D,IAAI,CAAC,MAAM,EAAE;AACb,YAAA,OAAO,KAAK;QACd;AAEA,QAAA,OAAO,IAAI;IACb;IAEA,OAAO,GAAA;QACL,OAAO,IAAI,CAAC,IAAI;IAClB;IAEA,QAAQ,GAAA;AACN,QAAA,OAAO,YAAY,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,cAAc,CAAC,OAAO,CAAC,YAAY,CAAC;IACnF;;AAGA,IAAA,eAAe,CAAC,SAAiB,EAAA;AAC/B,QAAA,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;AACtB,YAAA,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC;QAChE;AAEA,QAAA,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE;AAC7B,QAAA,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE;AAE3B,QAAA,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,EAAE;AACnB,YAAA,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC;QACvC;AAEA,QAAA,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,SAAS,CAAC;QAC9B,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,CAAC;AACzC,QAAA,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;AACvD,QAAA,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,gBAAgB,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC;AAE7D,QAAA,OAAO,GAAG,CAAC,QAAQ,EAAE;IACvB;;IAGA,kBAAkB,GAAA;QAChB,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QAC7D,MAAM,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC;QACzC,MAAM,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC;QAC1C,MAAM,SAAS,GAAG,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC;AAEjD,QAAA,IAAI,KAAK,IAAI,OAAO,IAAI,SAAS,EAAE;AACjC,YAAA,IAAI;gBACF,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;AAChC,gBAAA,MAAM,QAAQ,GAAG,QAAQ,CAAC,SAAS,CAAC;;AAGpC,gBAAA,IAAI,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,EAAE;AACzC,oBAAA,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC;;oBAGvB,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC;AACzC,oBAAA,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,YAAY,CAAC;AACrC,oBAAA,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,WAAW,CAAC;AACpC,oBAAA,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,gBAAgB,CAAC;AACzC,oBAAA,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,QAAQ,EAAE,CAAC;AAEnD,oBAAA,OAAO,IAAI;gBACb;YACF;YAAE,OAAO,CAAC,EAAE;AACV,gBAAA,OAAO,CAAC,KAAK,CAAC,kCAAkC,EAAE,CAAC,CAAC;YACtD;QACF;AAEA,QAAA,OAAO,KAAK;IACd;;IAGA,gBAAgB,CAAC,YAAoB,EAAE,YAAoB,EAAA;AACzD,QAAA,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;AACtB,YAAA,MAAM,IAAI,KAAK,CAAC,sCAAsC,CAAC;QACzD;AAEA,QAAA,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE;AAC7B,QAAA,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE;AAE3B,QAAA,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,EAAE;AACnB,YAAA,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC;QACvC;QAEA,YAAY,CAAC,WAAW,CAAC;AACvB,YAAA,IAAI,EAAE,YAAY;AAClB,YAAA,IAAI,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;SAC3C,EAAE,YAAY,CAAC;IAClB;AAEA,IAAA,SAAS,CAAC,QAAqC,EAAA;AAC7C,QAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC;AAC7B,QAAA,OAAO,MAAK;AACV,YAAA,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,QAAQ,CAAC;AAC7D,QAAA,CAAC;IACH;IAEQ,MAAM,GAAA;AACZ,QAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,IAAI,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACzD;IAIQ,SAAS,CAAC,IAAY,EAAE,IAAW,EAAA;;AAEzC,QAAA,MAAM,CAAC,WAAW,CAAC,EAAE,IAAI,EAAE,QAAQ,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,GAAG,CAAC;AACrE,QAAA,IAAI;AACF,YAAA,MAAM,OAAO,GAAG,IAAI,gBAAgB,CAAC,cAAc,CAAC;YACpD,OAAO,CAAC,WAAW,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;YACnC,OAAO,CAAC,KAAK,EAAE;QACjB;QAAE,OAAO,CAAC,EAAE;AACV,YAAA,OAAO,CAAC,IAAI,CAAC,gCAAgC,CAAC;QAChD;IACF;IAEQ,cAAc,GAAA;;QAEpB,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC;QAChD,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC;;QAG9C,MAAM,UAAU,GAAG,YAAY,CAAC,OAAO,CAAC,YAAY,CAAC;QACrD,MAAM,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,WAAW,CAAC;;AAGnD,QAAA,MAAM,KAAK,GAAG,WAAW,IAAI,UAAU;AACvC,QAAA,MAAM,OAAO,GAAG,UAAU,IAAI,SAAS;AAEvC,QAAA,IAAI,KAAK,IAAI,OAAO,EAAE;AACpB,YAAA,IAAI;gBACF,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;gBAC/B,MAAM,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,aAAa,CAAC;gBACrD,IAAI,SAAS,EAAE;AACb,oBAAA,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC,SAAS,CAAC;gBAC5C;YACF;YAAE,OAAO,CAAC,EAAE;AACV,gBAAA,OAAO,CAAC,KAAK,CAAC,iCAAiC,EAAE,CAAC,CAAC;gBACnD,IAAI,CAAC,MAAM,EAAE;YACf;QACF;IACF;IAEQ,wBAAwB,GAAA;AAC9B,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,kBAAkB;YAAE;;QAGrC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,KAAK,KAAI;YAC3C,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,YAAY,EAAE;AACpC,gBAAA,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI;;AAGlD,gBAAA,IAAI,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,EAAE;AAC1C,oBAAA,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC;gBACzB;YACF;AACF,QAAA,CAAC,CAAC;IACJ;AAEQ,IAAA,SAAS,CAAC,IAAY,EAAE,KAAa,EAAE,MAAc,EAAA;AAC3D,QAAA,MAAM,MAAM,GAAG,CAAA,EAAG,IAAI,CAAA,CAAA,EAAI,kBAAkB,CAAC,KAAK,CAAC,CAAA,UAAA,EAAa,MAAM,CAAA,iBAAA,EAAoB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAA,EAAA,EAAK,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,SAAS,GAAG,EAAE,aAAa,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE;AACvL,QAAA,QAAQ,CAAC,MAAM,GAAG,MAAM;IAC1B;AAEQ,IAAA,SAAS,CAAC,IAAY,EAAA;AAC5B,QAAA,MAAM,KAAK,GAAG,CAAA,EAAA,EAAK,QAAQ,CAAC,MAAM,EAAE;QACpC,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAA,EAAA,EAAK,IAAI,CAAA,CAAA,CAAG,CAAC;AACvC,QAAA,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;AACtB,YAAA,OAAO,kBAAkB,CAAC,KAAK,CAAC,GAAG,EAAE,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,IAAI,EAAE,CAAC;QAClE;AACA,QAAA,OAAO,IAAI;IACb;AAEQ,IAAA,YAAY,CAAC,IAAY,EAAA;QAC/B,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC;IAC9B;AAEA,IAAA,OAAO,wBAAwB,GAAA;;AAE7B,QAAA,IAAI;AACF,YAAA,MAAM,OAAO,GAAG,IAAI,gBAAgB,CAAC,cAAc,CAAC;AACpD,YAAA,OAAO,CAAC,SAAS,GAAG,CAAC,KAAK,KAAI;AAC5B,gBAAA,MAAM,OAAO,GAAG,IAAI,WAAW,EAAE;gBACjC,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;oBAC/B,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI;oBAC9B,OAAO,CAAC,MAAM,EAAE;gBAClB;qBAAO,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,QAAQ,EAAE;AACvC,oBAAA,OAAO,CAAC,IAAI,GAAG,IAAI;oBACnB,OAAO,CAAC,MAAM,EAAE;gBAClB;AACF,YAAA,CAAC;QACH;QAAE,OAAO,CAAC,EAAE;AACV,YAAA,OAAO,CAAC,IAAI,CAAC,gCAAgC,CAAC;QAChD;;QAGA,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,KAAK,KAAI;AAC3C,YAAA,MAAM,OAAO,GAAG,IAAI,WAAW,EAAE;YACjC,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,YAAY,EAAE;gBACpC,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI;gBAC9B,OAAO,CAAC,MAAM,EAAE;YAClB;iBAAO,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,aAAa,EAAE;AAC5C,gBAAA,OAAO,CAAC,IAAI,GAAG,IAAI;gBACnB,OAAO,CAAC,MAAM,EAAE;YAClB;AACF,QAAA,CAAC,CAAC;;QAGF,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,KAAK,KAAI;AAC3C,YAAA,IAAI,KAAK,CAAC,GAAG,KAAK,WAAW,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,QAAQ,EAAE;AAClE,gBAAA,MAAM,OAAO,GAAG,IAAI,WAAW,EAAE;AACjC,gBAAA,OAAO,CAAC,IAAI,GAAG,IAAI;gBACnB,OAAO,CAAC,MAAM,EAAE;YAClB;AACF,QAAA,CAAC,CAAC;IACJ;AACD;AAEM,MAAM,WAAW,GAAG,IAAI,WAAW;;;;"}