{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["// src/index.ts\r\ninterface User {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role?: string;\r\n}\r\n\r\nclass AuthManager {\r\n  private user: User | null = null;\r\n  private listeners: ((user: User | null) => void)[] = [];\r\n\r\n  constructor() {\r\n    if ((AuthManager as any).instance) {\r\n      return (AuthManager as any).instance;\r\n    }\r\n\r\n    this.restoreSession();\r\n    (AuthManager as any).instance = this;\r\n  }\r\n\r\n  login(user: User, token: string) {\r\n    this.user = user;\r\n    localStorage.setItem('auth:token', token);\r\n    localStorage.setItem('auth:user', JSON.stringify(user));\r\n    this.notify();\r\n    this.broadcast('login', user);\r\n  }\r\n\r\n  logout() {\r\n    this.user = null;\r\n    localStorage.removeItem('auth:token');\r\n    localStorage.removeItem('auth:user');\r\n    this.notify();\r\n    this.broadcast('logout');\r\n  }\r\n\r\n  isLoggedIn(): boolean {\r\n    return !!this.user;\r\n  }\r\n\r\n  getUser(): User | null {\r\n    return this.user;\r\n  }\r\n\r\n  subscribe(listener: (user: User | null) => void): () => void {\r\n    this.listeners.push(listener);\r\n    return () => {\r\n      this.listeners = this.listeners.filter(l => l !== listener);\r\n    };\r\n  }\r\n\r\n  private notify() {\r\n    this.listeners.forEach(listener => listener(this.user));\r\n  }\r\n\r\n  private broadcast(type: 'login', user: User): void;\r\n  private broadcast(type: 'logout'): void;\r\n  private broadcast(type: string, user?: User) {\r\n    // Cross-tab sync\r\n    window.postMessage({ type: `AUTH_${type.toUpperCase()}`, user }, '*');\r\n    try {\r\n      const channel = new BroadcastChannel('auth:channel');\r\n      channel.postMessage({ type, user });\r\n      channel.close();\r\n    } catch (e) {\r\n      console.warn('BroadcastChannel not supported');\r\n    }\r\n  }\r\n\r\n  restoreSession() {\r\n    const token = localStorage.getItem('auth:token');\r\n    const userStr = localStorage.getItem('auth:user');\r\n    if (token && userStr) {\r\n      this.user = JSON.parse(userStr);\r\n    }\r\n  }\r\n\r\n  static listenForExternalChanges() {\r\n    // Listen to BroadcastChannel\r\n    try {\r\n      const channel = new BroadcastChannel('auth:channel');\r\n      channel.onmessage = (event) => {\r\n        const manager = new AuthManager();\r\n        if (event.data.type === 'login') {\r\n          manager.user = event.data.user;\r\n          manager.notify();\r\n        } else if (event.data.type === 'logout') {\r\n          manager.user = null;\r\n          manager.notify();\r\n        }\r\n      };\r\n    } catch (e) {\r\n      console.warn('BroadcastChannel not available');\r\n    }\r\n\r\n    // Listen to postMessage (fallback)\r\n    window.addEventListener('message', (event) => {\r\n      const manager = new AuthManager();\r\n      if (event.data.type === 'AUTH_LOGIN') {\r\n        manager.user = event.data.user;\r\n        manager.notify();\r\n      } else if (event.data.type === 'AUTH_LOGOUT') {\r\n        manager.user = null;\r\n        manager.notify();\r\n      }\r\n    });\r\n\r\n    // Listen to localStorage changes (cross-tab)\r\n    window.addEventListener('storage', (event) => {\r\n      if (event.key === 'auth:user' && !event.newValue && event.oldValue) {\r\n        const manager = new AuthManager();\r\n        manager.user = null;\r\n        manager.notify();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport const authManager = new AuthManager();\r\nexport type { User };"],"names":[],"mappings":"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"}